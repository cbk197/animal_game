<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Game k√©o th·∫£ con v·∫≠t (Mobile & PC)</title>

<style>
* {
    box-sizing: border-box;
    /* NgƒÉn ch·∫∑n vi·ªác ch·ªçn vƒÉn b·∫£n khi ch∆°i game */
    user-select: none; 
    -webkit-user-select: none;
}

body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #eef6ff;
    height: 100vh;
    overflow: hidden;
    /* NgƒÉn cu·ªôn trang tr√™n mobile khi k√©o */
    overscroll-behavior: none; 
}

/* ===== HEADER ===== */
.header {
    height: 80px;
    text-align: center;
    padding-top: 8px;
}

.header h1 {
    font-size: clamp(18px, 2.5vw, 24px);
    margin: 0;
}

#score {
    font-size: clamp(16px, 2vw, 20px);
    font-weight: bold;
    color: #2c7;
    margin-top: 4px;
}

/* ===== GAME ===== */
.game {
    height: calc(100vh - 80px);
    display: flex;
    justify-content: center;
    gap: 24px;
    padding: 12px 24px;
}

/* ===== COLUMN ===== */
.column {
    flex: 1;
    max-width: 380px;
    display: grid;
    grid-template-rows: repeat(5, 1fr);
    gap: 12px;
    justify-items: center;
}

/* ===== BOX ===== */
.box {
    width: 80%;
    max-width: 260px;
    height: 100%;
    max-height: 110px;
    background: #fff;
    border: 2px dashed #aaa;
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

/* ===== IMAGE ===== */
.animal,
.shadow {
    width: clamp(40px, 55%, 75px);
    height: auto;
}

.animal {
    cursor: grab;
    /* Quan tr·ªçng cho mobile: t·∫Øt c√°c h√†nh ƒë·ªông m·∫∑c ƒë·ªãnh c·ªßa tr√¨nh duy·ªát */
    touch-action: none; 
    z-index: 10;
}

/* Class n√†y d√πng khi ƒëang k√©o tr√™n mobile */
.animal.dragging {
    position: fixed;
    pointer-events: none; /* ƒê·ªÉ touch event xuy√™n qua t√¨m element b√™n d∆∞·ªõi */
    z-index: 9999;
    opacity: 0.8;
    transform: scale(1.2);
}

.shadow {
    filter: brightness(0);
    opacity: 0.15; /* L√†m m·ªù b√≥ng h∆°n ch√∫t ƒë·ªÉ d·ªÖ nh√¨n */
    pointer-events: none;
}

.correct {
    border: 3px solid #4CAF50 !important;
    background-color: #e8f5e9;
}

/* ===== THI·∫æT B·ªä TH·∫§P ===== */
@media (max-height: 600px) {
    .box {
        max-height: 90px;
    }
}

/* ===== MOBILE ===== */
@media (max-width: 600px) {
    .game {
        gap: 12px;
        padding: 8px;
    }
    .column {
        max-width: none;
    }
    .box {
        width: 95%;
    }
}
</style>
</head>

<body>

<div class="header">
    <h1>üê† K√©o con v·∫≠t v√†o ƒë√∫ng b√≥ng</h1>
    <div id="score">ƒêi·ªÉm: 0</div>
</div>

<div class="game">
    <div class="column" id="left"></div>
    <div class="column" id="right"></div>
</div>

<script>
const animals = [
    { name: "shrimp", img: "https://img.icons8.com/?size=100&id=rm2ULHn0Cvt9&format=png&color=000000" },
    { name: "crab", img: "https://img.icons8.com/color/96/crab.png" },
    { name: "fish", img: "https://img.icons8.com/color/96/fish.png" }
];

// H√†m l·∫•y ng·∫´u nhi√™n
function randomAnimals(count) {
    const list = [];
    for(let i=0; i<count; i++) {
        list.push(animals[Math.floor(Math.random() * animals.length)]);
    }
    return list;
}

const leftCol = document.getElementById("left");
const rightCol = document.getElementById("right");
let score = 0;

// T·∫°o d·ªØ li·ªáu game
const leftAnimalsData = randomAnimals(5);
const rightAnimalsData = [...leftAnimalsData].sort(() => Math.random() - 0.5);

/* =========================================
   H√ÄM X·ª¨ L√ù LOGIC TOUCH (MOBILE)
   ========================================= */
let startX, startY, originalLeft, originalTop;
let currentDraggedElement = null;

function addTouchLogic(imgElement) {
    
    imgElement.addEventListener('touchstart', (e) => {
        // NgƒÉn cu·ªôn m√†n h√¨nh
        e.preventDefault();
        
        const touch = e.touches[0];
        currentDraggedElement = imgElement;
        
        // L∆∞u v·ªã tr√≠ ban ƒë·∫ßu ƒë·ªÉ n·∫øu sai th√¨ tr·∫£ v·ªÅ
        const rect = imgElement.getBoundingClientRect();
        
        // Thi·∫øt l·∫≠p tr·∫°ng th√°i ƒëang k√©o
        imgElement.classList.add('dragging');
        
        // C·∫≠p nh·∫≠t v·ªã tr√≠ ngay l·∫≠p t·ª©c theo ng√≥n tay
        updatePosition(touch.clientX, touch.clientY, imgElement);
    }, { passive: false });

    imgElement.addEventListener('touchmove', (e) => {
        e.preventDefault(); // R·∫•t quan tr·ªçng ƒë·ªÉ kh√¥ng b·ªã cu·ªôn trang
        if (!currentDraggedElement) return;
        
        const touch = e.touches[0];
        updatePosition(touch.clientX, touch.clientY, imgElement);
    }, { passive: false });

    imgElement.addEventListener('touchend', (e) => {
        if (!currentDraggedElement) return;
        
        const touch = e.changedTouches[0];
        
        // 1. T·∫Øt hi·ªÉn th·ªã t·∫°m th·ªùi ƒë·ªÉ t√¨m ph·∫ßn t·ª≠ b√™n d∆∞·ªõi ng√≥n tay
        imgElement.style.display = 'none';
        let elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
        imgElement.style.display = ''; // Hi·ªÉn th·ªã l·∫°i
        
        // 2. T√¨m xem c√≥ th·∫£ v√†o c√°i h·ªôp (box) n√†o kh√¥ng
        let targetBox = elementBelow ? elementBelow.closest('.box') : null;

        // 3. Ki·ªÉm tra logic ƒë√∫ng sai
        if (targetBox && targetBox.dataset.accept === imgElement.dataset.name && !targetBox.classList.contains("correct")) {
            // ƒê√öNG:
            handleCorrectDrop(imgElement, targetBox);
        } else {
            // SAI: Reset v·ªÅ v·ªã tr√≠ c≈©
            resetElement(imgElement);
        }

        currentDraggedElement = null;
    });
}

// C·∫≠p nh·∫≠t v·ªã tr√≠ ·∫£nh theo ng√≥n tay (cƒÉn gi·ªØa ·∫£nh v√†o ng√≥n tay)
function updatePosition(x, y, element) {
    element.style.left = (x - element.offsetWidth / 2) + 'px';
    element.style.top = (y - element.offsetHeight / 2) + 'px';
}

// Tr·∫£ ·∫£nh v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu
function resetElement(element) {
    element.classList.remove('dragging');
    element.style.left = '';
    element.style.top = '';
    element.style.position = '';
}

// X·ª≠ l√Ω khi th·∫£ ƒë√∫ng (D√πng chung cho c·∫£ Mobile v√† PC)
function handleCorrectDrop(imgElement, targetBox) {
    targetBox.classList.add("correct");
    targetBox.innerHTML = ""; // X√≥a b√≥ng ƒëen
    
    // Reset style mobile tr∆∞·ªõc khi append
    imgElement.classList.remove('dragging');
    imgElement.style.position = '';
    imgElement.style.left = '';
    imgElement.style.top = '';
    
    // T·∫Øt kh·∫£ nƒÉng k√©o ti·∫øp
    imgElement.draggable = false;
    // Clone node ƒë·ªÉ tr√°nh l·ªói event listener c≈© ho·∫∑c append tr·ª±c ti·∫øp
    const newImg = imgElement.cloneNode(true);
    targetBox.appendChild(newImg);
    
    // X√≥a ·∫£nh ·ªü c·ªôt tr√°i
    imgElement.remove();

    score++;
    document.getElementById("score").innerText = "ƒêi·ªÉm: " + score;
    
    if(score === 5) {
        setTimeout(() => alert("Ch√∫c m·ª´ng! B·∫°n ƒë√£ th·∫Øng!"), 200);
    }
}

/* =========================================
   KH·ªûI T·∫†O C·ªòT TR√ÅI (CON V·∫¨T)
   ========================================= */
leftAnimalsData.forEach((a, i) => {
    const box = document.createElement("div");
    box.className = "box";

    const img = document.createElement("img");
    img.src = a.img;
    img.className = "animal";
    img.draggable = true; // Gi·ªØ cho PC
    img.id = "drag-" + i;
    img.dataset.name = a.name;

    // --- S·ª∞ KI·ªÜN CHO PC (MOUSE) ---
    img.addEventListener("dragstart", e => {
        e.dataTransfer.setData("name", img.dataset.name);
        e.dataTransfer.setData("id", img.id);
    });

    // --- S·ª∞ KI·ªÜN CHO MOBILE (TOUCH) ---
    addTouchLogic(img);

    box.appendChild(img);
    leftCol.appendChild(box);
});

/* =========================================
   KH·ªûI T·∫†O C·ªòT PH·∫¢I (B√ìNG ƒêEN)
   ========================================= */
rightAnimalsData.forEach(a => {
    const box = document.createElement("div");
    box.className = "box";
    box.dataset.accept = a.name;

    // --- S·ª∞ KI·ªÜN CHO PC (DROP ZONE) ---
    box.addEventListener("dragover", e => e.preventDefault());

    box.addEventListener("drop", e => {
        e.preventDefault();
        const name = e.dataTransfer.getData("name");
        const id = e.dataTransfer.getData("id");
        const img = document.getElementById(id);

        if (name === box.dataset.accept && !box.classList.contains("correct")) {
            handleCorrectDrop(img, box);
        }
    });

    const shadow = document.createElement("img");
    shadow.src = a.img;
    shadow.className = "shadow";

    box.appendChild(shadow);
    rightCol.appendChild(box);
});
</script>

</body>
</html>
