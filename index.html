<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Game k√©o th·∫£ con v·∫≠t (Mobile & PC)</title>

<style>
* {
    box-sizing: border-box;
    user-select: none; 
    -webkit-user-select: none;
}

body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #eef6ff;
    height: 100vh;
    overflow: hidden;
    overscroll-behavior: none; 
}

/* ===== HEADER ===== */
.header {
    height: 100px; /* Increased height slightly for the button */
    text-align: center;
    padding-top: 8px;
    background-color: #fff;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.header h1 {
    font-size: clamp(18px, 2.5vw, 24px);
    margin: 0 0 5px 0;
    color: #333;
}

.control-panel {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
}

#score {
    font-size: clamp(16px, 2vw, 20px);
    font-weight: bold;
    color: #2c7;
}

/* New Button Style */
.btn-reset {
    background-color: #ff9800;
    color: white;
    border: none;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: transform 0.1s;
}

.btn-reset:active {
    transform: scale(0.95);
    background-color: #f57c00;
}

/* ===== GAME ===== */
.game {
    height: calc(100vh - 100px); /* Adjusted for header height */
    display: flex;
    justify-content: center;
    gap: 24px;
    padding: 12px 24px;
}

/* ===== COLUMN ===== */
.column {
    flex: 1;
    max-width: 380px;
    display: grid;
    grid-template-rows: repeat(5, 1fr);
    gap: 12px;
    justify-items: center;
}

/* ===== BOX ===== */
.box {
    width: 80%;
    max-width: 260px;
    height: 100%;
    max-height: 110px;
    background: #fff;
    border: 2px dashed #aaa;
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    transition: background-color 0.3s;
}

/* ===== IMAGE ===== */
.animal,
.shadow {
    width: clamp(40px, 55%, 75px);
    height: auto;
}

.animal {
    cursor: grab;
    touch-action: none; 
    z-index: 10;
}

.animal.dragging {
    position: fixed;
    pointer-events: none; 
    z-index: 9999;
    opacity: 0.8;
    transform: scale(1.2);
}

.shadow {
    filter: brightness(0);
    opacity: 0.15;
    pointer-events: none;
}

.correct {
    border: 3px solid #4CAF50 !important;
    background-color: #e8f5e9;
}

/* ===== THI·∫æT B·ªä TH·∫§P ===== */
@media (max-height: 600px) {
    .box {
        max-height: 90px;
    }
}

/* ===== MOBILE ===== */
@media (max-width: 600px) {
    .game {
        gap: 12px;
        padding: 8px;
    }
    .column {
        max-width: none;
    }
    .box {
        width: 95%;
    }
}
</style>
</head>

<body>

<div class="header">
    <h1>üê† K√©o con v·∫≠t v√†o ƒë√∫ng b√≥ng</h1>
    <div class="control-panel">
        <div id="score">ƒêi·ªÉm: 0</div>
        <button class="btn-reset" onclick="initGame()">üîÑ Ch∆°i l·∫°i</button>
    </div>
</div>

<div class="game">
    <div class="column" id="left"></div>
    <div class="column" id="right"></div>
</div>

<script>
const animals = [
    { name: "shrimp", img: "https://img.icons8.com/?size=100&id=rm2ULHn0Cvt9&format=png&color=000000" },
    { name: "crab", img: "https://img.icons8.com/?size=100&id=s0h6NKLkxJYl&format=png&color=000000" },
    { name: "fish", img: "https://img.icons8.com/?size=100&id=HigYjmxQTeyD&format=png&color=000000" },
    { name: "octopus", img: "https://img.icons8.com/?size=100&id=13023&format=png&color=000000" },
    { name: "turtle", img: "https://img.icons8.com/?size=100&id=16075&format=png&color=000000" }
];

const leftCol = document.getElementById("left");
const rightCol = document.getElementById("right");
const scoreEl = document.getElementById("score");
let score = 0;

// H√†m l·∫•y ng·∫´u nhi√™n
function randomAnimals(count) {
    const list = [];
    for(let i=0; i<count; i++) {
        list.push(animals[Math.floor(Math.random() * animals.length)]);
    }
    return list;
}

/* =========================================
   CORE LOGIC START / RESET GAME
   ========================================= */
function initGame() {
    // 1. Reset Score
    score = 0;
    scoreEl.innerText = "ƒêi·ªÉm: 0";
    
    // 2. Clear Columns
    leftCol.innerHTML = "";
    rightCol.innerHTML = "";

    // 3. Generate New Data
    const leftAnimalsData = randomAnimals(5);
    // Shuffle right column based on left column data so there is always a match
    const rightAnimalsData = [...leftAnimalsData].sort(() => Math.random() - 0.5);

    // 4. Create Left Column (Draggable Animals)
    leftAnimalsData.forEach((a, i) => {
        const box = document.createElement("div");
        box.className = "box";

        const img = document.createElement("img");
        img.src = a.img;
        img.className = "animal";
        img.draggable = true; // PC
        img.id = "drag-" + i;
        img.dataset.name = a.name;

        // PC Event
        img.addEventListener("dragstart", e => {
            e.dataTransfer.setData("name", img.dataset.name);
            e.dataTransfer.setData("id", img.id);
        });

        // Mobile Event
        addTouchLogic(img);

        box.appendChild(img);
        leftCol.appendChild(box);
    });

    // 5. Create Right Column (Shadow Drop Targets)
    rightAnimalsData.forEach(a => {
        const box = document.createElement("div");
        box.className = "box";
        box.dataset.accept = a.name;

        // PC Drop Events
        box.addEventListener("dragover", e => e.preventDefault());
        box.addEventListener("drop", e => {
            e.preventDefault();
            const name = e.dataTransfer.getData("name");
            const id = e.dataTransfer.getData("id");
            const img = document.getElementById(id);

            // Check if element exists (handling race conditions)
            if (img && name === box.dataset.accept && !box.classList.contains("correct")) {
                handleCorrectDrop(img, box);
            }
        });

        const shadow = document.createElement("img");
        shadow.src = a.img;
        shadow.className = "shadow";

        box.appendChild(shadow);
        rightCol.appendChild(box);
    });
}

/* =========================================
   LOGIC TOUCH (MOBILE)
   ========================================= */
let currentDraggedElement = null;

function addTouchLogic(imgElement) {
    imgElement.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        currentDraggedElement = imgElement;
        
        imgElement.classList.add('dragging');
        updatePosition(touch.clientX, touch.clientY, imgElement);
    }, { passive: false });

    imgElement.addEventListener('touchmove', (e) => {
        e.preventDefault();
        if (!currentDraggedElement) return;
        const touch = e.touches[0];
        updatePosition(touch.clientX, touch.clientY, imgElement);
    }, { passive: false });

    imgElement.addEventListener('touchend', (e) => {
        if (!currentDraggedElement) return;
        
        const touch = e.changedTouches[0];
        imgElement.style.display = 'none';
        let elementBelow = document.elementFromPoint(touch.clientX, touch.clientY);
        imgElement.style.display = ''; 
        
        let targetBox = elementBelow ? elementBelow.closest('.box') : null;

        if (targetBox && targetBox.dataset.accept === imgElement.dataset.name && !targetBox.classList.contains("correct")) {
            handleCorrectDrop(imgElement, targetBox);
        } else {
            resetElement(imgElement);
        }
        currentDraggedElement = null;
    });
}

function updatePosition(x, y, element) {
    element.style.left = (x - element.offsetWidth / 2) + 'px';
    element.style.top = (y - element.offsetHeight / 2) + 'px';
}

function resetElement(element) {
    element.classList.remove('dragging');
    element.style.left = '';
    element.style.top = '';
    element.style.position = '';
}

// Logic handle drop (Both PC & Mobile)
function handleCorrectDrop(imgElement, targetBox) {
    targetBox.classList.add("correct");
    targetBox.innerHTML = ""; 
    
    imgElement.classList.remove('dragging');
    imgElement.style.position = '';
    imgElement.style.left = '';
    imgElement.style.top = '';
    imgElement.draggable = false;
    
    const newImg = imgElement.cloneNode(true);
    targetBox.appendChild(newImg);
    
    imgElement.remove();

    score++;
    scoreEl.innerText = "ƒêi·ªÉm: " + score;
    
    if(score === 5) {
        setTimeout(() => {
            if(confirm("Ch√∫c m·ª´ng! B·∫°n ƒë√£ th·∫Øng! Ch∆°i l·∫°i kh√¥ng?")) {
                initGame();
            }
        }, 300);
    }
}

// START GAME ON LOAD
initGame();

</script>

</body>
</html>
